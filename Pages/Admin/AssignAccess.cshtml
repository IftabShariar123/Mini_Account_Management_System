@page "{role?}"
@model AssignAccessModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<h2>Assign Module Access</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<form method="post">
    <div class="form-group">
        <label>Select Role</label>
        <select asp-for="SelectedRole" asp-items="Model.Roles" class="form-control"></select>
    </div>

    <div class="form-group mt-3">
        <label>Modules</label><br />
        @for (int i = 0; i < Model.AllModules.Count; i++)
        {
            <div class="card mb-3">
                <div class="card-header">
                    <button type="button" class="btn btn-sm btn-outline-primary"
                            data-bs-toggle="collapse" data-bs-target="#module-@Model.AllModules[i].Replace(" ", "-")">
                        @Model.AllModules[i] <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="collapse" id="module-@Model.AllModules[i].Replace(" ", "-")">
                    <div class="card-body">
                        <input type="hidden" name="SelectedModules[@i].Name" value="@Model.AllModules[i]" />

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="SelectedModules[@i].CanCreate"
                                   value="true"
                            @(Model.SelectedModules[@i].CanCreate ? "checked" : "") />
                            <label class="form-check-label">Create</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="SelectedModules[@i].CanUpdate"
                                   value="true"
                            @(Model.SelectedModules[@i].CanUpdate ? "checked" : "") />
                            <label class="form-check-label">Update</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="SelectedModules[@i].CanDelete"
                                   value="true"
                            @(Model.SelectedModules[@i].CanDelete ? "checked" : "") />
                            <label class="form-check-label">Delete</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="SelectedModules[@i].CanViewList"
                                   value="true"
                            @(Model.SelectedModules[@i].CanViewList ? "checked" : "") />
                            <label class="form-check-label">List</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="SelectedModules[@i].CanViewDetails"
                                   value="true"
                            @(Model.SelectedModules[@i].CanViewDetails ? "checked" : "") />
                            <label class="form-check-label">Details</label>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <button type="submit" class="btn btn-primary mt-3">Assign Access</button>
</form>


@section Scripts {
        <script>
            document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(button => {
                button.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-plus')) {
                        icon.classList.remove('fa-plus');
                        icon.classList.add('fa-minus');
                    } else {
                        icon.classList.remove('fa-minus');
                        icon.classList.add('fa-plus');
                    }
                });
            });
        </script>
}